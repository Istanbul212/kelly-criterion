{"ast":null,"code":"import _extends from \"@babel/runtime/helpers/esm/extends\";\nimport { extent, max, median, min, range as d3Range } from 'd3-array';\nimport { scaleLinear, scaleLog, scaleTime, scaleUtc, scaleBand } from 'd3-scale';\n\nfunction defaultAxisOptions(options) {\n  var _options$elementType, _options$minTickPaddi, _options$tickLabelRot, _options$innerBandPad, _options$outerBandPad, _options$show, _options$stacked;\n\n  return _extends({}, options, {\n    elementType: (_options$elementType = options.elementType) != null ? _options$elementType : 'line',\n    minTickPaddingForRotation: (_options$minTickPaddi = options.minTickPaddingForRotation) != null ? _options$minTickPaddi : 10,\n    tickLabelRotationDeg: (_options$tickLabelRot = options.tickLabelRotationDeg) != null ? _options$tickLabelRot : 60,\n    innerBandPadding: (_options$innerBandPad = options.innerBandPadding) != null ? _options$innerBandPad : 0.6,\n    outerBandPadding: (_options$outerBandPad = options.outerBandPadding) != null ? _options$outerBandPad : 0.2,\n    show: (_options$show = options.show) != null ? _options$show : true,\n    stacked: (_options$stacked = options.stacked) != null ? _options$stacked : false\n  });\n}\n\nexport default function buildAxisLinear(isPrimary, userOptions, series, gridDimensions, width, height) {\n  var options = defaultAxisOptions(userOptions);\n\n  if (!options.position) {\n    throw new Error(\"Chart axes must have a valid 'position' property\");\n  }\n\n  var isVertical = ['left', 'right'].indexOf(options.position) > -1; // Now we need to figure out the range\n\n  var range = isVertical ? [gridDimensions.gridHeight, 0] : [0, gridDimensions.gridWidth];\n  var outerRange = isVertical ? [height, 0] : [0, width]; // Give the scale a home\n\n  return options.scaleType === 'time' || options.scaleType === 'localTime' ? buildTimeAxis(isPrimary, options, series, isVertical, range, outerRange) : options.scaleType === 'linear' || options.scaleType === 'log' ? buildLinearAxis(isPrimary, options, series, isVertical, range, outerRange) : options.scaleType === 'band' ? buildBandAxis(options, series, isVertical, range, outerRange) : function () {\n    throw new Error('Invalid scale type');\n  }();\n}\n\nfunction buildTimeAxis(isPrimary, options, series, isVertical, range, outerRange) {\n  var scaleFn = options.scaleType === 'localTime' ? scaleTime : scaleUtc; // Now set the range\n\n  var scale = scaleFn(range);\n  var allDatums = series.map(function (d) {\n    return d.datums;\n  }).flat();\n\n  var _extent = extent(allDatums, function (datum) {\n    return options.getValue(datum.originalDatum);\n  }),\n      minValue = _extent[0],\n      maxValue = _extent[1];\n\n  var shouldNice = true;\n\n  if (typeof options.min === 'number') {\n    minValue = min([options.min, minValue]);\n    shouldNice = false;\n  }\n\n  if (typeof options.max === 'number') {\n    maxValue = max([options.max, maxValue]);\n    shouldNice = false;\n  }\n\n  if (typeof options.hardMin === 'number') {\n    minValue = options.hardMin;\n    shouldNice = false;\n  }\n\n  if (typeof options.hardMax === 'number') {\n    maxValue = options.hardMax;\n    shouldNice = false;\n  }\n\n  if (minValue === undefined || maxValue === undefined) {\n    console.info({\n      options: options,\n      series: series,\n      range: range,\n      values: allDatums.map(function (d) {\n        return options.getValue(d.originalDatum);\n      })\n    });\n    throw new Error('Invalid scale min/max');\n  } // Set the domain\n\n\n  scale.domain([minValue, maxValue]);\n\n  if (options.invert) {\n    scale.domain(Array.from(scale.domain()).reverse());\n  }\n\n  if (shouldNice) {\n    scale.nice();\n  }\n\n  var outerScale = scale.copy().range(outerRange); // Supplmentary band scale\n\n  var bandScale = isPrimary ? buildImpliedBandScale(options, scale, series, range) : undefined;\n  var defaultFormat = scale.tickFormat();\n  var formatters = {};\n\n  var scaleFormat = function scaleFormat(value) {\n    var _options$formatters$s, _options$formatters;\n\n    return (_options$formatters$s = (_options$formatters = options.formatters) == null ? void 0 : _options$formatters.scale == null ? void 0 : _options$formatters.scale(value, _extends({}, formatters, {\n      scale: undefined\n    }))) != null ? _options$formatters$s : defaultFormat(value);\n  };\n\n  var tooltipFormat = function tooltipFormat(value) {\n    var _options$formatters$t, _options$formatters2;\n\n    return (_options$formatters$t = (_options$formatters2 = options.formatters) == null ? void 0 : _options$formatters2.tooltip == null ? void 0 : _options$formatters2.tooltip(value, _extends({}, formatters, {\n      tooltip: undefined\n    }))) != null ? _options$formatters$t : scaleFormat(value);\n  };\n\n  var cursorFormat = function cursorFormat(value) {\n    var _options$formatters$c, _options$formatters3;\n\n    return (_options$formatters$c = (_options$formatters3 = options.formatters) == null ? void 0 : _options$formatters3.cursor == null ? void 0 : _options$formatters3.cursor(value, _extends({}, formatters, {\n      cursor: undefined\n    }))) != null ? _options$formatters$c : tooltipFormat(value);\n  };\n\n  Object.assign(formatters, {\n    \"default\": defaultFormat,\n    scale: scaleFormat,\n    tooltip: tooltipFormat,\n    cursor: cursorFormat\n  });\n  return _extends({}, options, {\n    axisFamily: 'time',\n    isVertical: isVertical,\n    scale: scale,\n    range: range,\n    outerScale: outerScale,\n    bandScale: bandScale,\n    formatters: formatters\n  });\n}\n\nfunction buildLinearAxis(isPrimary, options, series, isVertical, range, outerRange) {\n  var scale = options.scaleType === 'log' ? scaleLog() : scaleLinear();\n  var allDatums = series.map(function (d) {\n    return d.datums;\n  }).flat(2);\n\n  var _ref = options.stacked ? extent(series.map(function (s) {\n    return s.datums.map(function (datum) {\n      var _datum$stackData;\n\n      return (_datum$stackData = datum.stackData) != null ? _datum$stackData : [];\n    });\n  }).flat(2)) : extent(allDatums, function (datum) {\n    return options.getValue(datum.originalDatum);\n  }),\n      minValue = _ref[0],\n      maxValue = _ref[1];\n\n  var shouldNice = true;\n\n  if (typeof options.min === 'number') {\n    minValue = min([options.min, minValue]);\n    shouldNice = false;\n  }\n\n  if (typeof options.max === 'number') {\n    maxValue = max([options.max, maxValue]);\n    shouldNice = false;\n  }\n\n  if (typeof options.minDomainLength === 'number' && !(minValue === undefined || maxValue === undefined)) {\n    var mid = median([minValue, maxValue]);\n    var top = mid + options.minDomainLength / 2;\n    var bottom = mid - options.minDomainLength / 2;\n    maxValue = Math.max(top, maxValue);\n    minValue = Math.min(bottom, minValue);\n  }\n\n  if (typeof options.hardMin === 'number') {\n    minValue = options.hardMin;\n    shouldNice = false;\n  }\n\n  if (typeof options.hardMax === 'number') {\n    maxValue = options.hardMax;\n    shouldNice = false;\n  }\n\n  if (minValue === undefined || maxValue === undefined) {\n    console.info({\n      options: options,\n      series: series,\n      range: range,\n      values: allDatums.map(function (d) {\n        return options.getValue(d.originalDatum);\n      })\n    });\n    throw new Error('Invalid scale min/max');\n  } // Set the domain\n\n\n  scale.domain([minValue, maxValue]);\n\n  if (options.invert) {\n    scale.domain(Array.from(scale.domain()).reverse());\n  }\n\n  scale.range(range);\n\n  if (shouldNice) {\n    scale.nice();\n  }\n\n  var outerScale = scale.copy().range(outerRange);\n  var bandScale = isPrimary ? buildImpliedBandScale(options, scale, series, range) : undefined;\n  var defaultFormat = scale.tickFormat();\n  var formatters = {};\n\n  var scaleFormat = function scaleFormat(value) {\n    var _options$formatters$s2, _options$formatters4;\n\n    return (_options$formatters$s2 = (_options$formatters4 = options.formatters) == null ? void 0 : _options$formatters4.scale == null ? void 0 : _options$formatters4.scale(value, _extends({}, formatters, {\n      scale: undefined\n    }))) != null ? _options$formatters$s2 : defaultFormat(value);\n  };\n\n  var tooltipFormat = function tooltipFormat(value) {\n    var _options$formatters$t2, _options$formatters5;\n\n    return (_options$formatters$t2 = (_options$formatters5 = options.formatters) == null ? void 0 : _options$formatters5.tooltip == null ? void 0 : _options$formatters5.tooltip(value, _extends({}, formatters, {\n      tooltip: undefined\n    }))) != null ? _options$formatters$t2 : scaleFormat(value);\n  };\n\n  var cursorFormat = function cursorFormat(value) {\n    var _options$formatters$c2, _options$formatters6;\n\n    return (_options$formatters$c2 = (_options$formatters6 = options.formatters) == null ? void 0 : _options$formatters6.cursor == null ? void 0 : _options$formatters6.cursor(value, _extends({}, formatters, {\n      cursor: undefined\n    }))) != null ? _options$formatters$c2 : tooltipFormat(value);\n  };\n\n  Object.assign(formatters, {\n    \"default\": defaultFormat,\n    scale: scaleFormat,\n    tooltip: tooltipFormat,\n    cursor: cursorFormat\n  });\n  return _extends({}, options, {\n    axisFamily: 'linear',\n    isVertical: isVertical,\n    scale: scale,\n    range: range,\n    outerScale: outerScale,\n    bandScale: bandScale,\n    formatters: formatters\n  });\n}\n\nfunction buildBandAxis(options, series, isVertical, range, outerRange) {\n  var _options$outerBandPad2, _options$innerBandPad2;\n\n  var domain = Array.from(new Set(series.map(function (d) {\n    return d.datums;\n  }).flat().map(function (datum) {\n    return options.getValue(datum.originalDatum);\n  })));\n  var scale = scaleBand(domain, range).round(false).paddingOuter((_options$outerBandPad2 = options.outerBandPadding) != null ? _options$outerBandPad2 : 0).paddingInner((_options$innerBandPad2 = options.innerBandPadding) != null ? _options$innerBandPad2 : 0); // Invert if necessary\n\n  if (options.invert) {\n    scale.domain(Array.from(scale.domain()).reverse());\n  }\n\n  var outerScale = scale.copy().range(outerRange);\n\n  var defaultFormat = function defaultFormat(d) {\n    return d;\n  };\n\n  var formatters = {};\n\n  var scaleFormat = function scaleFormat(value) {\n    var _options$formatters$s3, _options$formatters7;\n\n    return (_options$formatters$s3 = (_options$formatters7 = options.formatters) == null ? void 0 : _options$formatters7.scale == null ? void 0 : _options$formatters7.scale(value, _extends({}, formatters, {\n      scale: undefined\n    }))) != null ? _options$formatters$s3 : defaultFormat(value);\n  };\n\n  var tooltipFormat = function tooltipFormat(value) {\n    var _options$formatters$t3, _options$formatters8;\n\n    return (_options$formatters$t3 = (_options$formatters8 = options.formatters) == null ? void 0 : _options$formatters8.tooltip == null ? void 0 : _options$formatters8.tooltip(value, _extends({}, formatters, {\n      tooltip: undefined\n    }))) != null ? _options$formatters$t3 : scaleFormat(value);\n  };\n\n  var cursorFormat = function cursorFormat(value) {\n    var _options$formatters$c3, _options$formatters9;\n\n    return (_options$formatters$c3 = (_options$formatters9 = options.formatters) == null ? void 0 : _options$formatters9.cursor == null ? void 0 : _options$formatters9.cursor(value, _extends({}, formatters, {\n      cursor: undefined\n    }))) != null ? _options$formatters$c3 : tooltipFormat(value);\n  };\n\n  Object.assign(formatters, {\n    \"default\": defaultFormat,\n    scale: scaleFormat,\n    tooltip: tooltipFormat,\n    cursor: cursorFormat\n  });\n  return _extends({}, options, {\n    axisFamily: 'band',\n    isVertical: isVertical,\n    scale: scale,\n    range: range,\n    outerScale: outerScale,\n    formatters: formatters\n  });\n} //\n\n\nfunction buildImpliedBandScale(options, scale, series, range) {\n  var _options$outerBandPad3, _options$innerBandPad3; // Find the two closest points along axis\n\n\n  var impliedBandWidth = Math.max.apply(Math, range);\n  series.forEach(function (serie) {\n    serie.datums.forEach(function (d1) {\n      var _options$getValue;\n\n      var one = scale((_options$getValue = options.getValue(d1.originalDatum)) != null ? _options$getValue : NaN);\n      serie.datums.forEach(function (d2) {\n        var _options$getValue2;\n\n        var two = scale((_options$getValue2 = options.getValue(d2.originalDatum)) != null ? _options$getValue2 : NaN);\n\n        if (one === two) {\n          return;\n        }\n\n        var r = [one, two].sort();\n        var diff = Math.abs(r[1] - r[0]);\n\n        if (diff < impliedBandWidth) {\n          impliedBandWidth = diff;\n        }\n      });\n    });\n  });\n  var bandRange = Math.max.apply(Math, range);\n  var bandDomain = d3Range(bandRange / impliedBandWidth);\n  var bandScale = scaleBand(bandDomain, range).round(false).paddingOuter((_options$outerBandPad3 = options.outerBandPadding) != null ? _options$outerBandPad3 : 0).paddingInner((_options$innerBandPad3 = options.innerBandPadding) != null ? _options$innerBandPad3 : 0);\n  return bandScale;\n}","map":{"version":3,"sources":["/Users/samerkadih/Desktop/Coding/Personal/React/kelly-criterion/node_modules/react-charts/es/utils/buildAxis.linear.js"],"names":["_extends","extent","max","median","min","range","d3Range","scaleLinear","scaleLog","scaleTime","scaleUtc","scaleBand","defaultAxisOptions","options","_options$elementType","_options$minTickPaddi","_options$tickLabelRot","_options$innerBandPad","_options$outerBandPad","_options$show","_options$stacked","elementType","minTickPaddingForRotation","tickLabelRotationDeg","innerBandPadding","outerBandPadding","show","stacked","buildAxisLinear","isPrimary","userOptions","series","gridDimensions","width","height","position","Error","isVertical","indexOf","gridHeight","gridWidth","outerRange","scaleType","buildTimeAxis","buildLinearAxis","buildBandAxis","scaleFn","scale","allDatums","map","d","datums","flat","_extent","datum","getValue","originalDatum","minValue","maxValue","shouldNice","hardMin","hardMax","undefined","console","info","values","domain","invert","Array","from","reverse","nice","outerScale","copy","bandScale","buildImpliedBandScale","defaultFormat","tickFormat","formatters","scaleFormat","value","_options$formatters$s","_options$formatters","tooltipFormat","_options$formatters$t","_options$formatters2","tooltip","cursorFormat","_options$formatters$c","_options$formatters3","cursor","Object","assign","axisFamily","_ref","s","_datum$stackData","stackData","minDomainLength","mid","top","bottom","Math","_options$formatters$s2","_options$formatters4","_options$formatters$t2","_options$formatters5","_options$formatters$c2","_options$formatters6","_options$outerBandPad2","_options$innerBandPad2","Set","round","paddingOuter","paddingInner","_options$formatters$s3","_options$formatters7","_options$formatters$t3","_options$formatters8","_options$formatters$c3","_options$formatters9","_options$outerBandPad3","_options$innerBandPad3","impliedBandWidth","apply","forEach","serie","d1","_options$getValue","one","NaN","d2","_options$getValue2","two","r","sort","diff","abs","bandRange","bandDomain"],"mappings":"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","sourcesContent":["import _extends from \"@babel/runtime/helpers/esm/extends\";\nimport { extent, max, median, min, range as d3Range } from 'd3-array';\nimport { scaleLinear, scaleLog, scaleTime, scaleUtc, scaleBand } from 'd3-scale';\n\nfunction defaultAxisOptions(options) {\n  var _options$elementType, _options$minTickPaddi, _options$tickLabelRot, _options$innerBandPad, _options$outerBandPad, _options$show, _options$stacked;\n\n  return _extends({}, options, {\n    elementType: (_options$elementType = options.elementType) != null ? _options$elementType : 'line',\n    minTickPaddingForRotation: (_options$minTickPaddi = options.minTickPaddingForRotation) != null ? _options$minTickPaddi : 10,\n    tickLabelRotationDeg: (_options$tickLabelRot = options.tickLabelRotationDeg) != null ? _options$tickLabelRot : 60,\n    innerBandPadding: (_options$innerBandPad = options.innerBandPadding) != null ? _options$innerBandPad : 0.6,\n    outerBandPadding: (_options$outerBandPad = options.outerBandPadding) != null ? _options$outerBandPad : 0.2,\n    show: (_options$show = options.show) != null ? _options$show : true,\n    stacked: (_options$stacked = options.stacked) != null ? _options$stacked : false\n  });\n}\n\nexport default function buildAxisLinear(isPrimary, userOptions, series, gridDimensions, width, height) {\n  var options = defaultAxisOptions(userOptions);\n\n  if (!options.position) {\n    throw new Error(\"Chart axes must have a valid 'position' property\");\n  }\n\n  var isVertical = ['left', 'right'].indexOf(options.position) > -1; // Now we need to figure out the range\n\n  var range = isVertical ? [gridDimensions.gridHeight, 0] : [0, gridDimensions.gridWidth];\n  var outerRange = isVertical ? [height, 0] : [0, width]; // Give the scale a home\n\n  return options.scaleType === 'time' || options.scaleType === 'localTime' ? buildTimeAxis(isPrimary, options, series, isVertical, range, outerRange) : options.scaleType === 'linear' || options.scaleType === 'log' ? buildLinearAxis(isPrimary, options, series, isVertical, range, outerRange) : options.scaleType === 'band' ? buildBandAxis(options, series, isVertical, range, outerRange) : function () {\n    throw new Error('Invalid scale type');\n  }();\n}\n\nfunction buildTimeAxis(isPrimary, options, series, isVertical, range, outerRange) {\n  var scaleFn = options.scaleType === 'localTime' ? scaleTime : scaleUtc; // Now set the range\n\n  var scale = scaleFn(range);\n  var allDatums = series.map(function (d) {\n    return d.datums;\n  }).flat();\n\n  var _extent = extent(allDatums, function (datum) {\n    return options.getValue(datum.originalDatum);\n  }),\n      minValue = _extent[0],\n      maxValue = _extent[1];\n\n  var shouldNice = true;\n\n  if (typeof options.min === 'number') {\n    minValue = min([options.min, minValue]);\n    shouldNice = false;\n  }\n\n  if (typeof options.max === 'number') {\n    maxValue = max([options.max, maxValue]);\n    shouldNice = false;\n  }\n\n  if (typeof options.hardMin === 'number') {\n    minValue = options.hardMin;\n    shouldNice = false;\n  }\n\n  if (typeof options.hardMax === 'number') {\n    maxValue = options.hardMax;\n    shouldNice = false;\n  }\n\n  if (minValue === undefined || maxValue === undefined) {\n    console.info({\n      options: options,\n      series: series,\n      range: range,\n      values: allDatums.map(function (d) {\n        return options.getValue(d.originalDatum);\n      })\n    });\n    throw new Error('Invalid scale min/max');\n  } // Set the domain\n\n\n  scale.domain([minValue, maxValue]);\n\n  if (options.invert) {\n    scale.domain(Array.from(scale.domain()).reverse());\n  }\n\n  if (shouldNice) {\n    scale.nice();\n  }\n\n  var outerScale = scale.copy().range(outerRange); // Supplmentary band scale\n\n  var bandScale = isPrimary ? buildImpliedBandScale(options, scale, series, range) : undefined;\n  var defaultFormat = scale.tickFormat();\n  var formatters = {};\n\n  var scaleFormat = function scaleFormat(value) {\n    var _options$formatters$s, _options$formatters;\n\n    return (_options$formatters$s = (_options$formatters = options.formatters) == null ? void 0 : _options$formatters.scale == null ? void 0 : _options$formatters.scale(value, _extends({}, formatters, {\n      scale: undefined\n    }))) != null ? _options$formatters$s : defaultFormat(value);\n  };\n\n  var tooltipFormat = function tooltipFormat(value) {\n    var _options$formatters$t, _options$formatters2;\n\n    return (_options$formatters$t = (_options$formatters2 = options.formatters) == null ? void 0 : _options$formatters2.tooltip == null ? void 0 : _options$formatters2.tooltip(value, _extends({}, formatters, {\n      tooltip: undefined\n    }))) != null ? _options$formatters$t : scaleFormat(value);\n  };\n\n  var cursorFormat = function cursorFormat(value) {\n    var _options$formatters$c, _options$formatters3;\n\n    return (_options$formatters$c = (_options$formatters3 = options.formatters) == null ? void 0 : _options$formatters3.cursor == null ? void 0 : _options$formatters3.cursor(value, _extends({}, formatters, {\n      cursor: undefined\n    }))) != null ? _options$formatters$c : tooltipFormat(value);\n  };\n\n  Object.assign(formatters, {\n    \"default\": defaultFormat,\n    scale: scaleFormat,\n    tooltip: tooltipFormat,\n    cursor: cursorFormat\n  });\n  return _extends({}, options, {\n    axisFamily: 'time',\n    isVertical: isVertical,\n    scale: scale,\n    range: range,\n    outerScale: outerScale,\n    bandScale: bandScale,\n    formatters: formatters\n  });\n}\n\nfunction buildLinearAxis(isPrimary, options, series, isVertical, range, outerRange) {\n  var scale = options.scaleType === 'log' ? scaleLog() : scaleLinear();\n  var allDatums = series.map(function (d) {\n    return d.datums;\n  }).flat(2);\n\n  var _ref = options.stacked ? extent(series.map(function (s) {\n    return s.datums.map(function (datum) {\n      var _datum$stackData;\n\n      return (_datum$stackData = datum.stackData) != null ? _datum$stackData : [];\n    });\n  }).flat(2)) : extent(allDatums, function (datum) {\n    return options.getValue(datum.originalDatum);\n  }),\n      minValue = _ref[0],\n      maxValue = _ref[1];\n\n  var shouldNice = true;\n\n  if (typeof options.min === 'number') {\n    minValue = min([options.min, minValue]);\n    shouldNice = false;\n  }\n\n  if (typeof options.max === 'number') {\n    maxValue = max([options.max, maxValue]);\n    shouldNice = false;\n  }\n\n  if (typeof options.minDomainLength === 'number' && !(minValue === undefined || maxValue === undefined)) {\n    var mid = median([minValue, maxValue]);\n    var top = mid + options.minDomainLength / 2;\n    var bottom = mid - options.minDomainLength / 2;\n    maxValue = Math.max(top, maxValue);\n    minValue = Math.min(bottom, minValue);\n  }\n\n  if (typeof options.hardMin === 'number') {\n    minValue = options.hardMin;\n    shouldNice = false;\n  }\n\n  if (typeof options.hardMax === 'number') {\n    maxValue = options.hardMax;\n    shouldNice = false;\n  }\n\n  if (minValue === undefined || maxValue === undefined) {\n    console.info({\n      options: options,\n      series: series,\n      range: range,\n      values: allDatums.map(function (d) {\n        return options.getValue(d.originalDatum);\n      })\n    });\n    throw new Error('Invalid scale min/max');\n  } // Set the domain\n\n\n  scale.domain([minValue, maxValue]);\n\n  if (options.invert) {\n    scale.domain(Array.from(scale.domain()).reverse());\n  }\n\n  scale.range(range);\n\n  if (shouldNice) {\n    scale.nice();\n  }\n\n  var outerScale = scale.copy().range(outerRange);\n  var bandScale = isPrimary ? buildImpliedBandScale(options, scale, series, range) : undefined;\n  var defaultFormat = scale.tickFormat();\n  var formatters = {};\n\n  var scaleFormat = function scaleFormat(value) {\n    var _options$formatters$s2, _options$formatters4;\n\n    return (_options$formatters$s2 = (_options$formatters4 = options.formatters) == null ? void 0 : _options$formatters4.scale == null ? void 0 : _options$formatters4.scale(value, _extends({}, formatters, {\n      scale: undefined\n    }))) != null ? _options$formatters$s2 : defaultFormat(value);\n  };\n\n  var tooltipFormat = function tooltipFormat(value) {\n    var _options$formatters$t2, _options$formatters5;\n\n    return (_options$formatters$t2 = (_options$formatters5 = options.formatters) == null ? void 0 : _options$formatters5.tooltip == null ? void 0 : _options$formatters5.tooltip(value, _extends({}, formatters, {\n      tooltip: undefined\n    }))) != null ? _options$formatters$t2 : scaleFormat(value);\n  };\n\n  var cursorFormat = function cursorFormat(value) {\n    var _options$formatters$c2, _options$formatters6;\n\n    return (_options$formatters$c2 = (_options$formatters6 = options.formatters) == null ? void 0 : _options$formatters6.cursor == null ? void 0 : _options$formatters6.cursor(value, _extends({}, formatters, {\n      cursor: undefined\n    }))) != null ? _options$formatters$c2 : tooltipFormat(value);\n  };\n\n  Object.assign(formatters, {\n    \"default\": defaultFormat,\n    scale: scaleFormat,\n    tooltip: tooltipFormat,\n    cursor: cursorFormat\n  });\n  return _extends({}, options, {\n    axisFamily: 'linear',\n    isVertical: isVertical,\n    scale: scale,\n    range: range,\n    outerScale: outerScale,\n    bandScale: bandScale,\n    formatters: formatters\n  });\n}\n\nfunction buildBandAxis(options, series, isVertical, range, outerRange) {\n  var _options$outerBandPad2, _options$innerBandPad2;\n\n  var domain = Array.from(new Set(series.map(function (d) {\n    return d.datums;\n  }).flat().map(function (datum) {\n    return options.getValue(datum.originalDatum);\n  })));\n  var scale = scaleBand(domain, range).round(false).paddingOuter((_options$outerBandPad2 = options.outerBandPadding) != null ? _options$outerBandPad2 : 0).paddingInner((_options$innerBandPad2 = options.innerBandPadding) != null ? _options$innerBandPad2 : 0); // Invert if necessary\n\n  if (options.invert) {\n    scale.domain(Array.from(scale.domain()).reverse());\n  }\n\n  var outerScale = scale.copy().range(outerRange);\n\n  var defaultFormat = function defaultFormat(d) {\n    return d;\n  };\n\n  var formatters = {};\n\n  var scaleFormat = function scaleFormat(value) {\n    var _options$formatters$s3, _options$formatters7;\n\n    return (_options$formatters$s3 = (_options$formatters7 = options.formatters) == null ? void 0 : _options$formatters7.scale == null ? void 0 : _options$formatters7.scale(value, _extends({}, formatters, {\n      scale: undefined\n    }))) != null ? _options$formatters$s3 : defaultFormat(value);\n  };\n\n  var tooltipFormat = function tooltipFormat(value) {\n    var _options$formatters$t3, _options$formatters8;\n\n    return (_options$formatters$t3 = (_options$formatters8 = options.formatters) == null ? void 0 : _options$formatters8.tooltip == null ? void 0 : _options$formatters8.tooltip(value, _extends({}, formatters, {\n      tooltip: undefined\n    }))) != null ? _options$formatters$t3 : scaleFormat(value);\n  };\n\n  var cursorFormat = function cursorFormat(value) {\n    var _options$formatters$c3, _options$formatters9;\n\n    return (_options$formatters$c3 = (_options$formatters9 = options.formatters) == null ? void 0 : _options$formatters9.cursor == null ? void 0 : _options$formatters9.cursor(value, _extends({}, formatters, {\n      cursor: undefined\n    }))) != null ? _options$formatters$c3 : tooltipFormat(value);\n  };\n\n  Object.assign(formatters, {\n    \"default\": defaultFormat,\n    scale: scaleFormat,\n    tooltip: tooltipFormat,\n    cursor: cursorFormat\n  });\n  return _extends({}, options, {\n    axisFamily: 'band',\n    isVertical: isVertical,\n    scale: scale,\n    range: range,\n    outerScale: outerScale,\n    formatters: formatters\n  });\n} //\n\n\nfunction buildImpliedBandScale(options, scale, series, range) {\n  var _options$outerBandPad3, _options$innerBandPad3;\n\n  // Find the two closest points along axis\n  var impliedBandWidth = Math.max.apply(Math, range);\n  series.forEach(function (serie) {\n    serie.datums.forEach(function (d1) {\n      var _options$getValue;\n\n      var one = scale((_options$getValue = options.getValue(d1.originalDatum)) != null ? _options$getValue : NaN);\n      serie.datums.forEach(function (d2) {\n        var _options$getValue2;\n\n        var two = scale((_options$getValue2 = options.getValue(d2.originalDatum)) != null ? _options$getValue2 : NaN);\n\n        if (one === two) {\n          return;\n        }\n\n        var r = [one, two].sort();\n        var diff = Math.abs(r[1] - r[0]);\n\n        if (diff < impliedBandWidth) {\n          impliedBandWidth = diff;\n        }\n      });\n    });\n  });\n  var bandRange = Math.max.apply(Math, range);\n  var bandDomain = d3Range(bandRange / impliedBandWidth);\n  var bandScale = scaleBand(bandDomain, range).round(false).paddingOuter((_options$outerBandPad3 = options.outerBandPadding) != null ? _options$outerBandPad3 : 0).paddingInner((_options$innerBandPad3 = options.innerBandPadding) != null ? _options$innerBandPad3 : 0);\n  return bandScale;\n}"]},"metadata":{},"sourceType":"module"}